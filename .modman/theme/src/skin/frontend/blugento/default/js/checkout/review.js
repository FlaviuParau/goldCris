/*! blugento-theme v1.0.0 - 2023-01-24 20:07:47 */
;OrderReviewController=Class.create(),OrderReviewController.prototype={_canSubmitOrder:!1,_pleaseWait:!1,shippingSelect:!1,reloadByShippingSelect:!1,_copyElement:!1,onSubmitShippingSuccess:!1,shippingMethodsUpdateUrl:!1,_updateShippingMethods:!1,_ubpdateOrderButton:!1,shippingMethodsContainer:!1,_submitUpdateOrderUrl:!1,_itemsGrid:!1,initialize:function(a,b,c,d,e,f){a&&(this.form=a,b&&(this.formSubmit=b,Event.observe(b,"click",this._submitOrder.bind(this))),d?(this.reloadByShippingSelect=!0,d&&c?(this.shippingSelect=c,Event.observe(c,"change",this._submitShipping.bindAsEventListener(this,d.action,e)),this._updateOrderSubmit(!1)):this._canSubmitOrder=!0):(Form.getElements(this.form).each(this._bindElementChange,this),c&&$(c)?(this.shippingSelect=$(c).id,this.shippingMethodsContainer=$(this.shippingSelect).up()):this.shippingSelect=c,this._updateOrderSubmit(!1)))},addPleaseWait:function(a){a&&(this._pleaseWait=a)},_submitShipping:function(a,b,c){this.shippingSelect&&b&&c&&(this._updateOrderSubmit(!0),this._pleaseWait&&this._pleaseWait.show(),""!=this.shippingSelect.value&&new Ajax.Updater(c,b,{parameters:{isAjax:!0,shipping_method:this.shippingSelect.value},onComplete:function(){this._pleaseWait&&this._pleaseWait.hide()}.bind(this),onSuccess:this._onSubmitShippingSuccess.bind(this),evalScripts:!0}))},setUpdateButton:function(a,b,c){a&&(this._ubpdateOrderButton=a,this._submitUpdateOrderUrl=b,this._itemsGrid=c,Event.observe(a,"click",this._submitUpdateOrder.bindAsEventListener(this,b,c)),this.shippingSelect&&this._updateShipping(),this._updateOrderSubmit(!this._validateForm()),this.formValidator.reset(),this._clearValidation(""))},setCopyElement:function(a){a&&(this._copyElement=a,Event.observe(a,"click",this._copyShippingToBilling.bind(this)),this._copyShippingToBilling())},setShippingAddressContainer:function(a){a&&Form.getElements(a).each(function(a){"radio"==a.type.toLowerCase()||"checkbox"==a.type.toLowerCase()?Event.observe(a,"click",this._onShippingChange.bindAsEventListener(this)):Event.observe(a,"change",this._onShippingChange.bindAsEventListener(this))},this)},setShippingMethodContainer:function(a){a&&(this.shippingMethodsContainer=a)},_copyElementValue:function(a){var b=a.id.replace("shipping:","billing:");b&&$(b)&&"hidden"!=$(b).type&&($(b).value=a.value,$(b).setAttribute("readOnly","readonly"),$(b).addClassName("local-validation"),$(b).setStyle({opacity:.5}),$(b).disable())},_copyShippingToBilling:function(a){this._copyElement&&(this._copyElement.checked?(this._copyElementValue($("shipping:country_id")),billingRegionUpdater.update(),$$('[id^="shipping:"]').each(this._copyElementValue),this._clearValidation("billing")):($$('[id^="billing:"]').invoke("enable"),$$('[id^="billing:"]').each(function(a){a.removeAttribute("readOnly")}),$$('[id^="billing:"]').invoke("removeClassName","local-validation"),$$('[id^="billing:"]').invoke("setStyle",{opacity:1})),a&&this._updateOrderSubmit(!0))},_submitUpdateOrder:function(a,b,c){if(this._copyShippingToBilling(),b&&c&&this._validateForm()){this._copyElement&&this._copyElement.checked&&this._clearValidation("billing"),this._updateOrderSubmit(!0),this._pleaseWait&&this._pleaseWait.show(),this._toggleButton(this._ubpdateOrderButton,!0),arr=$$('[id^="billing:"]').invoke("enable");var d=this.form.serialize(!0);this._copyElement.checked&&($$('[id^="billing:"]').invoke("disable"),this._copyElement.enable()),d.isAjax=!0,new Ajax.Updater(c,b,{parameters:d,onComplete:function(){this._pleaseWait&&!this._updateShippingMethods&&this._pleaseWait.hide(),this._toggleButton(this._ubpdateOrderButton,!1)}.bind(this),onSuccess:this._updateShippingMethodsElement.bind(this),evalScripts:!0})}else this._copyElement&&this._copyElement.checked&&this._clearValidation("billing")},_updateShippingMethodsElement:function(){this._updateShippingMethods?new Ajax.Updater($(this.shippingMethodsContainer).up(),this.shippingMethodsUpdateUrl,{onComplete:this._updateShipping.bind(this),onSuccess:this._onSubmitShippingSuccess.bind(this),evalScripts:!1}):this._onSubmitShippingSuccess()},_updateShipping:function(){$(this.shippingSelect)&&($(this.shippingSelect).enable(),Event.stopObserving($(this.shippingSelect),"change"),this._bindElementChange($(this.shippingSelect)),Event.observe($(this.shippingSelect),"change",this._submitUpdateOrder.bindAsEventListener(this,this._submitUpdateOrderUrl,this._itemsGrid)),$(this.shippingSelect+"_update").hide(),$(this.shippingSelect).show()),this._updateShippingMethods=!1,this._pleaseWait&&this._pleaseWait.hide()},_validateForm:function(){return!!this.form&&(this.formValidator||(this.formValidator=new Validation(this.form)),this.formValidator.validate())},_onShippingChange:function(a){var b=Event.element(a);b==$(this.shippingSelect)||$(this.shippingSelect)&&$(this.shippingSelect).disabled||($(this.shippingSelect)&&($(this.shippingSelect).disable(),$(this.shippingSelect).hide(),$("advice-required-entry-"+this.shippingSelect)&&$("advice-required-entry-"+this.shippingSelect).hide()),this.shippingMethodsContainer&&$(this.shippingMethodsContainer)&&$(this.shippingMethodsContainer).hide(),this.shippingSelect&&$(this.shippingSelect+"_update")&&$(this.shippingSelect+"_update").show(),this._updateShippingMethods=!0)},_bindElementChange:function(a){"string"==typeof a.id&&"agreement"===a.id.substr(0,9)||Event.observe(a,"change",this._onElementChange.bindAsEventListener(this))},_onElementChange:function(){this._updateOrderSubmit(!0)},_clearValidation:function(a){var b="";a?(b='[id*="'+a+':"]',$$(b).each(function(a){a.up().removeClassName("validation-failed").removeClassName("validation-passed").removeClassName("validation-error")})):this.formValidator.reset(),$$(".validation-advice"+b).invoke("remove"),$$(".validation-failed"+b).invoke("removeClassName","validation-failed"),$$(".validation-passed"+b).invoke("removeClassName","validation-passed"),$$(".validation-error"+b).invoke("removeClassName","validation-error")},_submitOrder:function(){return this._canSubmitOrder&&(this.reloadByShippingSelect||this._validateForm())?(this.form.submit(),this._updateOrderSubmit(!0),this._ubpdateOrderButton&&(this._ubpdateOrderButton.addClassName("no-checkout"),this._ubpdateOrderButton.setStyle({opacity:.5})),void(this._pleaseWait&&this._pleaseWait.show())):void this._updateOrderSubmit(!0)},_onSubmitShippingSuccess:function(){this._updateOrderSubmit(!1),this.onSubmitShippingSuccess&&this.onSubmitShippingSuccess()},_updateOrderSubmit:function(a){var b=a||this.reloadByShippingSelect&&(!this.shippingSelect||""==this.shippingSelect.value);this._canSubmitOrder=!b,this.formSubmit&&this._toggleButton(this.formSubmit,b)},_toggleButton:function(a,b){a.disabled=b,a.removeClassName("no-checkout"),a.setStyle({opacity:1}),b&&(a.addClassName("no-checkout"),a.setStyle({opacity:.5}))}};;
